<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste - Normaliza√ß√£o com Banco</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; }
        .header { text-align: center; margin-bottom: 30px; padding: 20px; background: #28a745; color: white; border-radius: 10px; }
        .controls { background: #e8f5e8; padding: 20px; border-radius: 8px; margin: 20px 0; }
        .btn { padding: 10px 16px; border: none; border-radius: 4px; cursor: pointer; margin: 5px; }
        .btn-primary { background: #007bff; color: white; }
        .btn-success { background: #28a745; color: white; }
        .btn-warning { background: #ffc107; color: black; }
        .btn-danger { background: #dc3545; color: white; }
        .image-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin: 20px 0; }
        .image-item { text-align: center; padding: 15px; background: #f8f9fa; border-radius: 8px; border: 1px solid #dee2e6; }
        .image-item img { max-width: 100%; height: auto; border-radius: 4px; cursor: pointer; transition: transform 0.3s; }
        .image-item img:hover { transform: scale(1.05); }
        .log-area { background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 4px; padding: 15px; font-family: monospace; font-size: 12px; max-height: 300px; overflow-y: auto; margin: 20px 0; }
        .status-info { background: #d1ecf1; border: 1px solid #bee5eb; padding: 15px; border-radius: 8px; margin: 20px 0; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üíæ Teste de Normaliza√ß√£o com Banco</h1>
            <p>Sistema completo: Normaliza√ß√£o individual + Salvamento no banco + Restaura√ß√£o autom√°tica</p>
        </div>
        
        <div class="status-info">
            <strong>Status:</strong> <span id="status-text">Aguardando inicializa√ß√£o...</span>
        </div>
        
        <div class="controls">
            <h4>üéÆ Controles</h4>
            <button class="btn btn-primary" onclick="activateEditor()">üöÄ Ativar Editor</button>
            <button class="btn btn-success" onclick="normalizeSelected()">‚öôÔ∏è Normalizar Selecionada (300x200)</button>
            <button class="btn btn-warning" onclick="removeNormalization()">üóëÔ∏è Remover Normaliza√ß√£o</button>
            <button class="btn btn-danger" onclick="reloadPage()">üîÑ Recarregar (Testar Restaura√ß√£o)</button>
        </div>
        
        <div class="image-grid">
            <div class="image-item">
                <img src="assets/images/about/01.webp" alt="Teste 1" data-key="test_norm_img_1" onclick="selectImage(this)">
                <p><strong>Imagem 1</strong> - <span id="status-1">Original</span></p>
            </div>
            <div class="image-item">
                <img src="assets/images/about/02.webp" alt="Teste 2" data-key="test_norm_img_2" onclick="selectImage(this)">
                <p><strong>Imagem 2</strong> - <span id="status-2">Original</span></p>
            </div>
            <div class="image-item">
                <img src="assets/images/team/01.webp" alt="Teste 3" data-key="test_norm_img_3" onclick="selectImage(this)">
                <p><strong>Imagem 3</strong> - <span id="status-3">Original</span></p>
            </div>
        </div>
        
        <div class="log-area" id="log-area">Aguardando atividades...</div>
    </div>

    <!-- Scripts do HARDEM Editor -->
    <script src="assets/js/editor/editor-utils.js"></script>
    <script src="assets/js/editor/editor-storage.js"></script>
    <script src="assets/js/editor/editor-image.js"></script>
    <script src="assets/js/editor/editor-text.js"></script>
    <script src="assets/js/editor/editor-ui.js"></script>
    <script src="assets/js/editor/editor-core.js"></script>

    <script>
        let editor = null;
        let selectedImage = null;
        
        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            const logArea = document.getElementById('log-area');
            logArea.innerHTML += `[${timestamp}] ${message}\n`;
            logArea.scrollTop = logArea.scrollHeight;
            console.log(message);
        }
        
        function updateStatus(status) {
            document.getElementById('status-text').textContent = status;
        }
        
        function selectImage(img) {
            // Remover sele√ß√£o anterior
            document.querySelectorAll('img').forEach(i => {
                i.style.border = '';
            });
            
            // Selecionar nova imagem
            selectedImage = img;
            img.style.border = '3px solid #007bff';
            
            if (editor && editor.selectElement) {
                editor.selectElement(img);
            }
            
            log(`üéØ Imagem selecionada: ${img.getAttribute('data-key')}`);
        }
        
        function updateImageStatus(img, isNormalized, dimensions = null) {
            const dataKey = img.getAttribute('data-key');
            const num = dataKey.split('_').pop();
            const statusElement = document.getElementById(`status-${num}`);
            
            if (statusElement) {
                if (isNormalized) {
                    statusElement.textContent = dimensions ? `Normalizada ${dimensions.width}x${dimensions.height}` : 'Normalizada';
                    statusElement.style.color = '#28a745';
                } else {
                    statusElement.textContent = 'Original';
                    statusElement.style.color = '#6c757d';
                }
            }
        }
        
        function activateEditor() {
            try {
                log('üöÄ Ativando HARDEM Editor...');
                
                if (typeof HardemEditorCore !== 'undefined') {
                    editor = new HardemEditorCore();
                    window.hardemEditor = editor;
                    log('‚úÖ Editor ativado com sucesso!');
                    updateStatus('Editor ativo - Clique em uma imagem para selecionar');
                } else {
                    log('‚ùå Erro: HardemEditorCore n√£o encontrado');
                    updateStatus('Erro na ativa√ß√£o do editor');
                }
            } catch (error) {
                log(`‚ùå Erro ao ativar editor: ${error.message}`);
                updateStatus('Erro na ativa√ß√£o');
            }
        }
        
        function normalizeSelected() {
            if (!selectedImage) {
                log('‚ùå Nenhuma imagem selecionada');
                alert('Selecione uma imagem primeiro!');
                return;
            }
            
            if (!editor || !editor.imageEditor) {
                log('‚ùå Editor n√£o est√° ativo');
                alert('Ative o editor primeiro!');
                return;
            }
            
            const targetDims = { width: 300, height: 200 };
            log(`‚öôÔ∏è Normalizando imagem: ${selectedImage.getAttribute('data-key')} para ${targetDims.width}x${targetDims.height}`);
            
            editor.imageEditor.normalizeIndividualImage(selectedImage, targetDims);
            updateImageStatus(selectedImage, true, targetDims);
            
            log('‚úÖ Normaliza√ß√£o aplicada! Dados salvos no banco de dados.');
            log('üí° Recarregue a p√°gina para testar a restaura√ß√£o autom√°tica');
        }
        
        function removeNormalization() {
            if (!selectedImage) {
                log('‚ùå Nenhuma imagem selecionada');
                return;
            }
            
            if (!editor || !editor.imageEditor) {
                log('‚ùå Editor n√£o est√° ativo');
                return;
            }
            
            if (!selectedImage.hasAttribute('data-normalized')) {
                log('‚ö†Ô∏è Imagem n√£o est√° normalizada');
                return;
            }
            
            log(`üóëÔ∏è Removendo normaliza√ß√£o: ${selectedImage.getAttribute('data-key')}`);
            editor.imageEditor.removeIndividualNormalization(selectedImage);
            updateImageStatus(selectedImage, false);
            log('‚úÖ Normaliza√ß√£o removida e exclu√≠da do banco');
        }
        
        function reloadPage() {
            log('üîÑ Recarregando p√°gina para testar restaura√ß√£o...');
            setTimeout(() => {
                window.location.reload();
            }, 500);
        }
        
        // Inicializa√ß√£o autom√°tica
        document.addEventListener('DOMContentLoaded', function() {
            log('üìã P√°gina de teste carregada');
            updateStatus('Clique em "Ativar Editor" para come√ßar');
            
            // Ativar editor automaticamente
            setTimeout(() => {
                activateEditor();
            }, 1000);
        });
        
        // Monitor de mudan√ßas de normaliza√ß√£o
        const observer = new MutationObserver((mutations) => {
            mutations.forEach((mutation) => {
                if (mutation.type === 'attributes' && mutation.attributeName === 'data-normalized') {
                    const img = mutation.target;
                    if (img.tagName.toLowerCase() === 'img') {
                        const isNormalized = img.hasAttribute('data-normalized');
                        if (isNormalized) {
                            const width = img.getAttribute('data-target-width');
                            const height = img.getAttribute('data-target-height');
                            updateImageStatus(img, true, { width, height });
                            log(`üîÑ Normaliza√ß√£o detectada: ${img.getAttribute('data-key')} (${width}x${height})`);
                        } else {
                            updateImageStatus(img, false);
                            log(`üîÑ Normaliza√ß√£o removida: ${img.getAttribute('data-key')}`);
                        }
                    }
                }
            });
        });
        
        // Observar mudan√ßas em todas as imagens
        document.querySelectorAll('img[data-key]').forEach(img => {
            observer.observe(img, { attributes: true, attributeFilter: ['data-normalized'] });
        });
    </script>


    <!-- Editor Refatorado - M√≥dulos (ordem importante) -->
    <script src="assets/js/editor/editor-utils.js"></script>
    <script src="assets/js/editor/editor-storage.js"></script>
    <script src="assets/js/editor/editor-ui.js"></script>
    <script src="assets/js/editor/editor-text.js"></script>
    <script src="assets/js/editor/editor-image.js"></script>
    <script src="assets/js/editor/editor-carousel.js"></script>
    <script src="assets/js/editor/editor-core.js"></script>
    <script src="assets/js/editor-refatorado.js"></script>
</body>
</html> 
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug ContentMap - HARDEM</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .debug-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background: #f9f9f9;
        }
        .debug-title {
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
            font-size: 16px;
        }
        .debug-content {
            background: #fff;
            padding: 10px;
            border-radius: 3px;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        .btn {
            background: #007cba;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .btn:hover {
            background: #005a87;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .stat-box {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 5px;
            text-align: center;
        }
        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #1976d2;
        }
        .stat-label {
            color: #666;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Debug ContentMap - HARDEM Editor</h1>
        <p>Esta p√°gina ajuda a debuggar o que est√° sendo salvo no contentMap do editor.</p>
        
        <div style="text-align: center; margin: 20px 0;">
            <button class="btn" onclick="debugContentMap()">üîç Analisar ContentMap</button>
            <button class="btn" onclick="debugSeparation()">üìä Testar Separa√ß√£o</button>
            <button class="btn" onclick="clearDebug()">üßπ Limpar</button>
        </div>

        <div class="stats" id="stats" style="display: none;">
            <div class="stat-box">
                <div class="stat-number" id="totalElements">0</div>
                <div class="stat-label">Total de Elementos</div>
            </div>
            <div class="stat-box">
                <div class="stat-number" id="totalImages">0</div>
                <div class="stat-label">Imagens Normais</div>
            </div>
            <div class="stat-box">
                <div class="stat-number" id="totalBackgrounds">0</div>
                <div class="stat-label">Backgrounds</div>
            </div>
            <div class="stat-box">
                <div class="stat-number" id="totalTexts">0</div>
                <div class="stat-label">Textos</div>
            </div>
            <div class="stat-box">
                <div class="stat-number" id="totalOthers">0</div>
                <div class="stat-label">Outros</div>
            </div>
        </div>

        <div class="debug-section" id="contentMapSection" style="display: none;">
            <div class="debug-title">üìã ContentMap Completo</div>
            <div class="debug-content" id="contentMapContent"></div>
        </div>

        <div class="debug-section" id="separationSection" style="display: none;">
            <div class="debug-title">üìä Separa√ß√£o por Tipo</div>
            <div class="debug-content" id="separationContent"></div>
        </div>

        <div class="debug-section" id="imagesSection" style="display: none;">
            <div class="debug-title">üñºÔ∏è Imagens Detectadas</div>
            <div class="debug-content" id="imagesContent"></div>
        </div>

        <div class="debug-section" id="backgroundsSection" style="display: none;">
            <div class="debug-title">üé® Backgrounds Detectados</div>
            <div class="debug-content" id="backgroundsContent"></div>
        </div>
    </div>

    <script>
        function debugContentMap() {
            try {
                // Verificar se o HARDEM Editor est√° dispon√≠vel
                if (typeof window.hardemEditor === 'undefined') {
                    alert('‚ùå HARDEM Editor n√£o encontrado! Abra esta p√°gina no contexto do editor.');
                    return;
                }

                const contentMap = window.hardemEditor.contentMap || {};
                const entries = Object.entries(contentMap);

                // Mostrar estat√≠sticas
                document.getElementById('stats').style.display = 'grid';
                document.getElementById('totalElements').textContent = entries.length;

                // Mostrar contentMap completo
                document.getElementById('contentMapSection').style.display = 'block';
                document.getElementById('contentMapContent').textContent = JSON.stringify(contentMap, null, 2);

                console.log('üîç ContentMap Debug:', contentMap);
                console.log('üìä Total de elementos:', entries.length);

            } catch (error) {
                console.error('‚ùå Erro no debug:', error);
                alert('‚ùå Erro ao debuggar ContentMap: ' + error.message);
            }
        }

        function debugSeparation() {
            try {
                // Verificar se o HARDEM Editor est√° dispon√≠vel
                if (typeof window.hardemEditor === 'undefined') {
                    alert('‚ùå HARDEM Editor n√£o encontrado! Abra esta p√°gina no contexto do editor.');
                    return;
                }

                const contentMap = window.hardemEditor.contentMap || {};
                const entries = Object.entries(contentMap);

                // Separar por tipo de conte√∫do (mesma l√≥gica do saveContentInParts)
                const images = entries.filter(([key, value]) => value.src && value.src.startsWith('data:'));
                const backgrounds = entries.filter(([key, value]) => value.backgroundImage && value.backgroundImage.startsWith('data:'));
                const texts = entries.filter(([key, value]) => value.text || value.title || value.description);
                const others = entries.filter(([key, value]) => 
                    !value.src?.startsWith('data:') && 
                    !value.backgroundImage?.startsWith('data:') && 
                    !value.text && !value.title && !value.description
                );

                // Atualizar estat√≠sticas
                document.getElementById('stats').style.display = 'grid';
                document.getElementById('totalElements').textContent = entries.length;
                document.getElementById('totalImages').textContent = images.length;
                document.getElementById('totalBackgrounds').textContent = backgrounds.length;
                document.getElementById('totalTexts').textContent = texts.length;
                document.getElementById('totalOthers').textContent = others.length;

                // Mostrar separa√ß√£o
                const separationData = {
                    images: images.map(([key, value]) => ({
                        key,
                        type: value.type,
                        hasData: value.src ? value.src.substring(0, 50) + '...' : 'NO DATA',
                        size: value.src ? Math.round(value.src.length / 1024) + 'KB' : '0KB'
                    })),
                    backgrounds: backgrounds.map(([key, value]) => ({
                        key,
                        type: value.type,
                        hasData: value.backgroundImage ? value.backgroundImage.substring(0, 50) + '...' : 'NO DATA',
                        size: value.backgroundImage ? Math.round(value.backgroundImage.length / 1024) + 'KB' : '0KB'
                    })),
                    texts: texts.map(([key, value]) => ({
                        key,
                        text: value.text ? value.text.substring(0, 100) + '...' : '',
                        title: value.title ? value.title.substring(0, 50) + '...' : '',
                        description: value.description ? value.description.substring(0, 50) + '...' : ''
                    })),
                    others: others.map(([key, value]) => ({
                        key,
                        type: value.type || 'unknown',
                        properties: Object.keys(value)
                    }))
                };

                document.getElementById('separationSection').style.display = 'block';
                document.getElementById('separationContent').textContent = JSON.stringify(separationData, null, 2);

                // Mostrar detalhes das imagens
                if (images.length > 0) {
                    document.getElementById('imagesSection').style.display = 'block';
                    document.getElementById('imagesContent').textContent = JSON.stringify(
                        Object.fromEntries(images), null, 2
                    );
                }

                // Mostrar detalhes dos backgrounds
                if (backgrounds.length > 0) {
                    document.getElementById('backgroundsSection').style.display = 'block';
                    document.getElementById('backgroundsContent').textContent = JSON.stringify(
                        Object.fromEntries(backgrounds), null, 2
                    );
                }

                console.log('üìä Separa√ß√£o Debug:', separationData);
                console.log(`üìä Dividindo: ${images.length} imagens, ${backgrounds.length} backgrounds, ${texts.length} textos, ${others.length} outros`);

            } catch (error) {
                console.error('‚ùå Erro na separa√ß√£o:', error);
                alert('‚ùå Erro ao testar separa√ß√£o: ' + error.message);
            }
        }

        function clearDebug() {
            document.getElementById('stats').style.display = 'none';
            document.getElementById('contentMapSection').style.display = 'none';
            document.getElementById('separationSection').style.display = 'none';
            document.getElementById('imagesSection').style.display = 'none';
            document.getElementById('backgroundsSection').style.display = 'none';
        }

        // Auto-executar se estiver no contexto do editor
        window.addEventListener('load', () => {
            setTimeout(() => {
                if (typeof window.hardemEditor !== 'undefined') {
                    console.log('‚úÖ HARDEM Editor detectado! Voc√™ pode usar os bot√µes de debug.');
                } else {
                    console.log('‚ö†Ô∏è HARDEM Editor n√£o detectado. Abra esta p√°gina no contexto do editor.');
                }
            }, 1000);
        });
    </script>


    <!-- Editor Refatorado - M√≥dulos (ordem importante) -->
    <script src="assets/js/editor/editor-utils.js"></script>
    <script src="assets/js/editor/editor-storage.js"></script>
    <script src="assets/js/editor/editor-ui.js"></script>
    <script src="assets/js/editor/editor-text.js"></script>
    <script src="assets/js/editor/editor-image.js"></script>
    <script src="assets/js/editor/editor-carousel.js"></script>
    <script src="assets/js/editor/editor-core.js"></script>
    <script src="assets/js/editor-refatorado.js"></script>
</body>
</html> 
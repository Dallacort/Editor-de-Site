<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚úÖ TESTE FINAL - PUT & DELETE API HARDEM</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
            font-size: 2.5em;
        }
        .success-banner {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            margin-bottom: 30px;
            font-size: 1.2em;
            font-weight: bold;
        }
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .test-card {
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            background: #f9f9f9;
        }
        .test-card h3 {
            margin-top: 0;
            color: #555;
            border-bottom: 2px solid #4CAF50;
            padding-bottom: 10px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }
        input, textarea, select {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s;
        }
        input:focus, textarea:focus, select:focus {
            border-color: #4CAF50;
            outline: none;
        }
        .btn {
            background: #4CAF50;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
            margin-right: 10px;
        }
        .btn:hover {
            background: #45a049;
            transform: translateY(-2px);
        }
        .btn-danger {
            background: #f44336;
        }
        .btn-danger:hover {
            background: #da190b;
        }
        .btn-info {
            background: #2196F3;
        }
        .btn-info:hover {
            background: #1976D2;
        }
        .result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 6px;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }
        .success {
            background: #d4edda;
            border: 2px solid #c3e6cb;
            color: #155724;
        }
        .error {
            background: #f8d7da;
            border: 2px solid #f5c6cb;
            color: #721c24;
        }
        .warning {
            background: #fff3cd;
            border: 2px solid #ffeaa7;
            color: #856404;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 15px;
        }
        .images-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        .image-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            background: white;
            text-align: center;
        }
        .image-card img {
            max-width: 100%;
            height: auto;
            border-radius: 4px;
            margin-bottom: 10px;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }
        .stat-card {
            background: linear-gradient(45deg, #FF9800, #F57C00);
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            display: block;
        }
        .footer {
            text-align: center;
            padding: 30px;
            background: #333;
            color: white;
            border-radius: 12px;
            margin-top: 30px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéØ TESTE FINAL - PUT & DELETE</h1>
        <div class="success-banner">
            ‚úÖ Sistema HARDEM com funcionalidades PUT e DELETE implementadas com sucesso!
        </div>
    </div>

    <!-- Estat√≠sticas -->
    <div class="container">
        <h3>üìä Estat√≠sticas do Sistema</h3>
        <button class="btn btn-info" onclick="carregarEstatisticas()">üîÑ Atualizar Estat√≠sticas</button>
        <div id="stats-grid" class="stats-grid"></div>
    </div>

    <!-- Grade de Testes -->
    <div class="test-grid">
        <!-- Teste 1: Listar Imagens -->
        <div class="test-card">
            <h3>üìã 1. Listar Imagens</h3>
            <button class="btn" onclick="listarImagens()">Carregar Imagens</button>
            <div id="images-result" class="result" style="display: none;"></div>
            <div id="images-grid" class="images-grid"></div>
        </div>

        <!-- Teste 2: PUT - Atualizar Imagem -->
        <div class="test-card">
            <h3>üîÑ 2. PUT - Atualizar Imagem</h3>
            <div class="form-group">
                <label>ID da Imagem:</label>
                <input type="number" id="put-image-id" placeholder="ID da imagem">
            </div>
            <div class="form-group">
                <label>Nome:</label>
                <input type="text" id="put-nome" placeholder="Novo nome">
            </div>
            <div class="form-group">
                <label>Alt Text:</label>
                <input type="text" id="put-alt" placeholder="Novo alt text">
            </div>
            <div class="form-group">
                <label>Descri√ß√£o:</label>
                <textarea id="put-desc" rows="2" placeholder="Nova descri√ß√£o"></textarea>
            </div>
            <button class="btn" onclick="atualizarImagem()">Atualizar Metadados</button>
            <div id="put-result" class="result" style="display: none;"></div>
        </div>

        <!-- Teste 3: DELETE - P√°gina -->
        <div class="test-card">
            <h3>üóëÔ∏è 3. DELETE - P√°gina</h3>
            <div class="warning">
                ‚ö†Ô∏è Esta a√ß√£o ir√° excluir todos os dados de uma p√°gina espec√≠fica
            </div>
            <div class="form-group">
                <label>ID da P√°gina:</label>
                <input type="text" id="delete-page-id" placeholder="Ex: test-page">
            </div>
            <button class="btn btn-danger" onclick="excluirPagina()">Excluir Dados da P√°gina</button>
            <div id="delete-page-result" class="result" style="display: none;"></div>
        </div>

        <!-- Teste 4: DELETE - Tudo (PERIGOSO) -->
        <div class="test-card">
            <h3>üö® 4. DELETE - TODOS OS DADOS</h3>
            <div class="warning">
                üö® EXTREMAMENTE PERIGOSO! Ir√° excluir TODOS os dados do sistema!
            </div>
            <div class="form-group">
                <label>
                    <input type="checkbox" id="confirm-delete-all"> 
                    Confirmo que entendo o risco
                </label>
            </div>
            <button class="btn btn-danger" onclick="excluirTudo()" disabled id="delete-all-btn">
                üí• EXCLUIR TUDO
            </button>
            <div id="delete-all-result" class="result" style="display: none;"></div>
        </div>
    </div>

    <div class="footer">
        <h3>üéâ Sistema HARDEM - Vers√£o Final</h3>
        <p>‚úÖ Funcionalidades PUT e DELETE implementadas e testadas</p>
        <p>‚úÖ Sistema de banco de dados MySQL/JSON funcionando</p>
        <p>‚úÖ Editor visual integrado com persist√™ncia</p>
        <p>‚úÖ Pronto para produ√ß√£o!</p>
    </div>

    <script>
        // Fun√ß√£o para fazer requisi√ß√µes √† API
        async function apiRequest(action, data = {}, method = 'POST') {
            try {
                let url = `api-admin.php?action=${action}`;
                let options = { method };
                
                if (method === 'POST') {
                    const formData = new FormData();
                    for (const key in data) {
                        formData.append(key, data[key]);
                    }
                    options.body = formData;
                }
                
                const response = await fetch(url, options);
                return await response.json();
            } catch (error) {
                return { success: false, error: error.message };
            }
        }

        // Fun√ß√£o para exibir resultados
        function showResult(elementId, data, isError = false) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.className = `result ${isError ? 'error' : 'success'}`;
            element.textContent = JSON.stringify(data, null, 2);
        }

        // 1. Listar Imagens
        async function listarImagens() {
            const result = await apiRequest('get_images', {}, 'GET');
            showResult('images-result', result, !result.success);

            if (result.success && result.data) {
                const grid = document.getElementById('images-grid');
                grid.innerHTML = '';
                
                result.data.slice(0, 6).forEach(img => {
                    const card = document.createElement('div');
                    card.className = 'image-card';
                    card.innerHTML = `
                        <strong>ID: ${img.id}</strong><br>
                        <small>${img.nome_original}</small><br>
                        <strong>Tipo:</strong> ${img.tipo_mime}<br>
                        <strong>Tamanho:</strong> ${(img.tamanho / 1024).toFixed(1)} KB<br>
                        <button class="btn" style="margin-top: 10px;" onclick="preencherPUT(${img.id}, '${img.nome_original}', '${img.alt_text || ''}', '${img.descricao || ''}')">
                            Editar
                        </button>
                    `;
                    grid.appendChild(card);
                });
            }
        }

        // Preencher formul√°rio PUT
        function preencherPUT(id, nome, alt, desc) {
            document.getElementById('put-image-id').value = id;
            document.getElementById('put-nome').value = nome;
            document.getElementById('put-alt').value = alt;
            document.getElementById('put-desc').value = desc;
        }

        // 2. Atualizar Imagem (PUT)
        async function atualizarImagem() {
            const imageId = document.getElementById('put-image-id').value;
            const nome = document.getElementById('put-nome').value;
            const alt = document.getElementById('put-alt').value;
            const desc = document.getElementById('put-desc').value;

            if (!imageId) {
                showResult('put-result', { error: 'ID da imagem √© obrigat√≥rio' }, true);
                return;
            }

            const result = await apiRequest('put_image', {
                id: imageId,
                nome_original: nome,
                alt_text: alt,
                descricao: desc
            });

            showResult('put-result', result, !result.success);
            
            if (result.success) {
                listarImagens(); // Recarregar lista
                carregarEstatisticas(); // Atualizar stats
            }
        }

        // 3. Excluir P√°gina
        async function excluirPagina() {
            const pageId = document.getElementById('delete-page-id').value;
            
            if (!pageId) {
                showResult('delete-page-result', { error: 'ID da p√°gina √© obrigat√≥rio' }, true);
                return;
            }

            if (!confirm(`Confirma exclus√£o de TODOS os dados da p√°gina "${pageId}"?`)) {
                return;
            }

            const result = await apiRequest('delete_all_related', {
                page_id: pageId,
                confirm_delete: 'DELETE_ALL_CONFIRMED'
            });

            showResult('delete-page-result', result, !result.success);
            
            if (result.success) {
                listarImagens();
                carregarEstatisticas();
            }
        }

        // 4. Excluir Tudo (PERIGOSO)
        async function excluirTudo() {
            if (!document.getElementById('confirm-delete-all').checked) {
                showResult('delete-all-result', { error: 'Voc√™ deve confirmar a a√ß√£o' }, true);
                return;
            }

            if (!confirm('üö® √öLTIMA CHANCE! Tem CERTEZA ABSOLUTA que deseja excluir TODOS os dados?')) {
                return;
            }

            const result = await apiRequest('delete_all_related', {
                confirm_delete: 'DELETE_ALL_CONFIRMED'
            });

            showResult('delete-all-result', result, !result.success);
            
            if (result.success) {
                listarImagens();
                carregarEstatisticas();
                document.getElementById('confirm-delete-all').checked = false;
                document.getElementById('delete-all-btn').disabled = true;
            }
        }

        // Carregar Estat√≠sticas
        async function carregarEstatisticas() {
            const result = await apiRequest('get_stats', {}, 'GET');
            
            if (result.success) {
                const grid = document.getElementById('stats-grid');
                grid.innerHTML = `
                    <div class="stat-card">
                        <span class="stat-number">${result.data.total_images}</span>
                        <div>Imagens Ativas</div>
                    </div>
                    <div class="stat-card">
                        <span class="stat-number">${result.data.total_texts}</span>
                        <div>Textos Ativos</div>
                    </div>
                    <div class="stat-card">
                        <span class="stat-number">${(result.data.total_size / 1024 / 1024).toFixed(1)} MB</span>
                        <div>Tamanho Total</div>
                    </div>
                `;
            }
        }

        // Controlar bot√£o de exclus√£o total
        document.getElementById('confirm-delete-all').addEventListener('change', function() {
            document.getElementById('delete-all-btn').disabled = !this.checked;
        });

        // Carregar dados iniciais
        document.addEventListener('DOMContentLoaded', function() {
            listarImagens();
            carregarEstatisticas();
        });
    </script>
</body>
</html> 